---
title: Gulp 前端自动化工作流
category: 开发工具
tags:
  - Gulp
  - 自动化
abbrlink: '48995743'
date: 2018-02-01 15:26:49
---

![](https://i.loli.net/2018/02/01/5a72c21986995.png)

初识 [Gulp](https://www.gulpjs.com.cn/) 是因为公司项目逐渐需要进行前后端分离，既然脱离了~~世界上最好的语言~~ PHP 后，也就没了 `include` 函数的支持，面临最大的问题就是页面 `header` 、 `footer` 等一些公用部分的代码要怎么在每个页面上引用，手动复制肯定不行。

在网上搜寻一番后，发现了 [gulp-file-include](https://www.npmjs.com/package/gulp-file-include) 这个插件，后面的故事，就像每个热恋中的人一样，恨不得每天都和 [Gulp](https://www.gulpjs.com.cn/) 腻在一起。

经过半年的相处，也大概摸透了 [Gulp](https://www.gulpjs.com.cn/) 的一些习性，并根据工作上的流程，整理了一套公司内部的前端自动化部署的开发环境。

<!-- more -->

{% note warning %}
本文不是 [Gulp](https://www.gulpjs.com.cn/) 的使用介绍，关于 [Gulp](https://www.gulpjs.com.cn/) 入门，请自行学习。
{% endnote %}

## gulp-automation

{% cq %}
**少罗嗦，先看东西**
{% endcq %}

<script src='//gitee.com/eoner/gulp-automation/widget_preview'></script>

## 如何使用

### 安装

首先将 [gulp-automation](https://gitee.com/eoner/gulp-automation) 下载到本地，下载好后推荐使用 Yarn 安装

``` bash
$ yarn install
```

![](https://i.loli.net/2018/02/01/5a72cee181f7f.png)

### 运行

``` bash
$ gulp
```

成功运行后，会自动打开浏览器并访问 http://localhost:3000 页面

### 编写代码

原始页面全部在 `page` 目录下编写。打开 `page` 目录会看到有一个 `index.html` 页面

``` html
<!DOCTYPE html>
<html lang="en">
<head>
    <!-- 引用公用页面采用以下方式 -->
    @@include('include/head.html')
</head>
<body>
    <h1>Test Page !</h1>
    <div class="test-img"></div>
    <script src="@@webRoot/static/js/main.js" charset="utf-8"></script>
</body>
</html>
```

可以看到，和正常写 HTML 代码没什么区别。对于公用代码的引用，通过这样语法进行引用

```
@@include('<页面地址>')
```

这里其实就是用到了 [gulp-file-include](https://www.npmjs.com/package/gulp-file-include) ，更多语法参数点 [这里](https://www.npmjs.com/package/gulp-file-include) 查看！

通过上面可得知，`page/include/` 是用来存放公用部分的代码的。

这时候可能又会遇到一个问题，不是所有网站的页面都存放在根目录下的，可能会按照功能模块的不同，划分出不同的文件夹来存放不同的页面，比如我们经常会看到这样的链接：

> - www.xxx.com/index.html
> - www.xxx.com/news/detail.html?nid=2
> - www.xxx.com/product/info.html?pid=1

网站首页存放在根目录，新闻相关页面存放在 `news` 文件夹下，产品相关页面存放在 `product` 文件夹下。

这里我的做法是把所有模块都放到 `page/module/` 目录下，打开目录就可以看到一个 `banner` 文件夹，你可以在这个目录下随意创建其它模块文件夹。

### 发布/打包

发布

``` bash
$ gulp build
```

发布并打包

``` bash
$ gulp build --z
```

{% note info %}
- 修改 `package.json` 里的 `name` 参数，可改变打包出来压缩包文件的命名
- 打包时使用了 [gulp-tinypng-nokey](https://www.npmjs.com/package/gulp-tinypng-nokey) 插件进行图片压缩，需要将图片上传到服务器压缩后再下载，请确保打包时网络畅通
{% endnote %}

## 参考

- [Gulp 中文网](https://www.gulpjs.com.cn/)
- [Gulp探究折腾之路(I)](https://www.jianshu.com/p/9768a4dc7cf7)
- [gulp使用小结(一)](http://www.cnblogs.com/Darren_code/p/gulp.html)
- [前端构建工具gulpjs的使用介绍及技巧](http://www.cnblogs.com/2050/p/4198792.html)
- [常用gulp插件介绍(一)](http://pinkyjie.com/2015/08/02/commonly-used-gulp-plugins-part-1/)
- [重构你的gulpfile](http://pinkyjie.com/2015/03/24/refactor-your-gulpfile/)